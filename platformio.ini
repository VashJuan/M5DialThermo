[platformio]
; IDE configuration
default_envs = m5dial
; Disable automatic opening of PIO Home and platformio.ini
core_dir = .
description = M5 Stack Dial Thermostat Project

[env:m5dial]
platform = espressif32
board = m5stack-cores3
framework = arduino

; M5Dial specific configuration
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio
board_build.partitions = default_8MB.csv
board_upload.flash_size = 8MB

; Upload configuration
upload_protocol = esptool
upload_port = COM4
upload_speed = 921600

; Monitor configuration
monitor_port = COM4
monitor_speed = 9600

; Build flags and libraries
build_flags = 
    -DARDUINO_M5STACK_CORES3
    ; Remove PSRAM flags that may be causing issues
    ; -DBOARD_HAS_PSRAM
    ; -mfix-esp32-psram-cache-issue
    -DWDT_TIMEOUT=20
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_240=y
    ; Network connectivity improvements
    ; NOTE: Compiler warnings of CONFIG_LWIP_LOCAL_HOSTNAME redefinition is common in ESP32 projects & doesn't affect functionality.
    -DCONFIG_LWIP_LOCAL_HOSTNAME=\"m5dial-thermo\"
    -DARDUINO_ENABLE_WIFI_SCAN=1
    ; NTP and time configuration
    -DCONFIG_LWIP_SNTP_MAX_SERVERS=3
    -DCONFIG_LWIP_DHCP_GET_NTP_SRV=1

; Filesystem configuration
board_build.filesystem = spiffs

lib_deps = 
    m5stack/M5Unified@^0.1.13
    m5stack/M5GFX@^0.1.15
    adafruit/Adafruit MCP9808 Library@^2.0.1
    bblanchon/ArduinoJson@^7.0.4
    ; HTTPClient is included with ESP32 Arduino framework

; Source filter to include only necessary files
build_src_filter = 
    +<*.ino>
    +<*.cpp>
    +<*.hpp>
    -<.git/>
    -<.svn/>